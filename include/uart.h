/*
 *uart.h
 *
 * Библиотека для работы с UART на AVR (ATmega328p)
 * Особенность: Асинхронный приём через Кольцевой Буфер (Ring Buffer)
 * Это позволяет принимать данные в фоне, не блокируя основной цикл процессора
*/

#ifndef UART_H_
#define UART_H_

#include <avr/io.h>
#include <avr/interrupt.h>

// Размер буфера приёма
// Если придёт больше 64 байт, а мы не успеем прочитать - старые данные будут затерты
// Рекомендуется степень двойки: 16, 32, 64, 128
#define UART_BUFFER_SIZE 64

/**
 * @brief Инициализация UART.
 * Настраивает скорость, включает RX/TX и разрешает прерывания.
 * @param baud Желаемая скорость (9600, 115200 и т.д.)
 */
void UART_Init(uint16_t baut);


/**
 * @brief Проверяет, есть ли непрочитанные данные в буфере.
 * @return Количество доступных байт (0 = пусто).
 */
uint8_t UART_Available(void);


/**
 * @brief Читает один байт из буфера (FIFO).
 * @return Байт данных или 0, если буфер пуст.
 */
char UART_Read(void);


/**
 * @brief Отправляет один байт (Блокирующая функция).
 * Ждет, пока регистр отправки освободится.
 * @param data Символ для отправки.
 */
void UART_Write(char data);


/**
 * @brief Отправляет строку текста.
 * @param str Указатель на строку (должна заканчиваться \0).
 */
void UART_Print(char* str); // Отправить СТРОКУ

#endif 